<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Raleway:100,300" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <link href="../static/css/styles.css" th:href="@{/css/email.css}" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Enviar mail</title>
  </head>
  <body>

    <div class="container">
        <div class="row">
            <div class="col s8 offset-s2">
                <div id="contenido" class="m2">
                    
                    <header id="header" class=" pink darken-1">
                        Enviar Email
                    </header>
                    <form id="enviar-mail" action="#" class="col s10 offset-s1">
                        <div class="row">
                                <div class="input-field col s12">
                                    <input id="email" type="email">
                                    <label for="email">Para:</label>
                                </div>
                                <div class="input-field col s12">
                                        <input id="asunto" type="text">
                                        <label for="asunto">Assunto</label>
                                </div>
                        </div>

                            <div class="row">
                                <div class="input-field col s12">
                                <textarea id="mensagem" class="materialize-textarea"></textarea>
                                <label for="mensagem">Mensagem</label>
                                </div>
                            </div>
                            <div class="row" id="loaders">
    
                                <img id="spinner" src="img/spinner.gif" width="150">
                            </div>
                            <div class="row">
                                    <div class="col s6">
                                        <button id="enviar" class="btn waves-effect waves-light  pink darken-2" type="submit" name="action">Enviar
                                                <i class="material-icons right">send</i>
                                        </button>
                                    </div>
                                    <div class="col s6">
                                        <button id="resetBtn" class="btn waves-effect waves-light light-blue darken-2" type="submit">Reset
                                                <i class="material-icons right">delete</i>
                                        </button>
                                    </div>
                            </div>
                    </form> 
                    
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    
    <script src="js/app.js">
    const email = document.getElementById('email');
const assunto = document.getElementById('asunto');
const mensagem= document.getElementById('mensaje');
const btnEnviar = document.getElementById('enviar');
const formularioEnviar = document.getElementById('enviar-mail');
const resetBtn = document.getElementById('resetBtn');


eventListeners();

function eventListeners() {
     
     document.addEventListener('DOMContentLoaded', inicioApp);

     email.addEventListener('blur', validarCampo);
     assunto.addEventListener('blur', validarCampo);
     mensagem.addEventListener('blur', validarCampo);

   
     formularioEnviar.addEventListener('submit', enviarEmail);

     resetBtn.addEventListener('click', resetFormulario);
}




function inicioApp() {
    
     btnEnviar.disabled = true;
}

function validarCampo() {
    
    
     validarLongitud(this);

     
     if(this.type === 'email') {
          validarEmail(this);
     }

     let errores = document.querySelectorAll('.error');

     if(email.value !== '' && asunto.value !== '' && mensaje.value !== '' ) {
          if(errores.length === 0) {
               btnEnviar.disabled = false;
          }
     }
}


function resetFormulario(e) {
     formularioEnviar.reset();
     e.preventDefault();
}


function enviarEmail(e) {
     
     const spinnerGif = document.querySelector('#spinner');
     spinnerGif.style.display = 'block';

    
     const enviado = document.createElement('img');
     enviado.src = 'img/mail.gif';
     enviado.style.display = 'block';

    

     setTimeout(function() {
          spinnerGif.style.display = 'none';

          document.querySelector('#loaders').appendChild( enviado );

          setTimeout(function() {
               enviado.remove();
               formularioEnviar.reset();
          }, 5000);
     }, 3000);

     e.preventDefault();
}


function validarLongitud(campo) {

     if(campo.value.length > 0 ) {
          campo.style.borderBottomColor = 'green';
          campo.classList.remove('error');
     } else {
          campo.style.borderBottomColor = 'red';
          campo.classList.add('error');
     }
}

function validarEmail(campo) {
     const mensaje = campo.value;
     if(mensaje.indexOf('@') !== -1 ) {
          campo.style.borderBottomColor = 'green';
          campo.classList.remove('error');
     } else {
          campo.style.borderBottomColor = 'red';
          campo.classList.add('error');
     }
}
    </script>
  	
  
  
  </body>
</html>
      